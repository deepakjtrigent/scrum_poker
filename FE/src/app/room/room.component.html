<div class="main">
  <div
    class="w-screen flex justify-around h-screen flex-col items-center xxs:h-auto overflow-hidden"
  >
    <div
      class="w-full flex justify-between items-center align-middle mt-6 ml-24"
    >
      <img
        src="../../assets/scrum_poker.svg"
        class="h-12 mr-3"
        alt="Scrum Poker Logo"
      />
      <div class="flex mr-24 items-center justify-center">
        <button
          [matMenuTriggerFor]="menu"
          class="grouping_button flex flex-row"
        >
          <mat-icon class="group_icon items-center ml-2">groups</mat-icon>
          <div class="font-inner-text text-base ml-2 text-main-text mr-2">
            Collaborators
          </div>
        </button>
        <mat-menu #menu="matMenu" xPosition="after">
          <div
            id="spacer"
            class="scrollable-menu flex flex-col items-center justify-between"
          >
            <div
              mat-menu-item
              *ngFor="let activeUser of usersArray"
              (click)="$event.stopPropagation()"
            >
              <div class="flex flex-row items-center namefield">
                <ng-container [ngSwitch]="activeUser.userData.jobRole">
                  <span *ngSwitchCase="jobRole[0]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[1]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[2]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[3]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[4]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[5]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[6]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[7]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                  <span *ngSwitchCase="jobRole[8]">{{
                    getSampleValue(activeUser.userData.jobRole)
                  }}</span>
                </ng-container>

                <div
                  id=""
                  class="text-main-text flex flex-row items-center font-inner-text justify-start ml-2 mt-1 text-base"
                >
                  {{
                    activeUser.userData.displayName.length < 14
                      ? activeUser.userData.displayName
                      : (activeUser.userData.displayName.slice(0, 14)
                        | titlecase)
                  }}
                  <div
                    class="text-main-text"
                    *ngIf="activeUser.userData.displayName.length > 14"
                  >
                    ...
                  </div>
                  <div class="text-main-text admin_button font-inner-text">
                    <div *ngIf="activeUser.userData.isAdmin">
                      <div class="material-symbols-outlined ml-1 mt-1 ">
                        admin_panel_settings
                      </div>
                      <p class="admin_title">Admin</p>
                    </div>
                  </div>
                </div>
                <div class="change_admin_icon">
                  <button
                    *ngIf="user.isAdmin && !activeUser.userData.isAdmin"
                    mat-icon-button
                    [matMenuTriggerFor]="menu"
                  >
                    <mat-icon>more_horiz</mat-icon>
                  </button>
                </div>
              </div>

              <mat-menu #menu="matMenu" yPosition="below">
                <button
                  class="p-0"
                  mat-menu-item
                  (click)="changeAdminUser(activeUser.userData)"
                >
                  <span class="font-inner-text text-main-text text-base"
                    >Set As Admin</span
                  >
                </button>
              </mat-menu>
            </div>
          </div>
        </mat-menu>
        <p class="ml-6 font-mono flex flex-col items-center">
          <span class="font-inner-text text-lg text-main-text">{{
            user.displayName
          }}</span>

          <span class="font-inner-text text-main-text text-sm">{{
            user.jobRole | replace:'_':' '  | titlecase
          }}</span>
        </p>
        <span class="font-inner-text text-main-text mt-1 ml-2 emoji_data">
          <ng-container [ngSwitch]="user.jobRole">
            <span *ngSwitchCase="jobRole[0]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[1]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[2]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[3]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[4]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[5]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[6]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[7]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
            <span *ngSwitchCase="jobRole[8]" class="text-3xl">{{
              getSampleValue(user.jobRole)
            }}</span>
          </ng-container>
        </span>
      </div>
    </div>
    <div
      class="w-screen flex justify-around h-screen flex-col xxs:h-auto overflow-hidden"
    >
      <div
        class="w-full h-3/4 xxs:h-[550px] xs:h-[700px] overflow-hidden flex flex-col justify-center items-center gap-7 xxs:gap-3 xs:gap-4"
      >
        <div
          class="w-1/2 h-3/5 xxs:w-[250px] xxs:p-0 xxs:h-[330px] xs:w-[380px] xs:h-[450px] sm:w-[600px] md:w-9/12 lg:w-8/12 xxs:flex-cols-3 xs:flex-cols-3 xxs:gap-4 xs:gap-6 flex flex-wrap gap-14 justify-center overflow-y-auto overflow-x-hidden p-5 xs:p-1"
        >
          <div
            *ngFor="let user of usersArray"
            class="text-primary-color w-[120px] xxs:w-[70px] xs:w-[90px] flex flex-col justify-center items-center gap-2 animate-popin-animation"
          >
            <ng-container [ngSwitch]="user.actionType">
              <img
                *ngSwitchCase="'STORY_POINT_SELECTION'"
                src="../../assets/selected-state.svg"
                alt="Selected State"
              />
              <img
                *ngSwitchCase="'STORY_POINT_HIDDEN'"
                src="../../assets/hidden-state.svg"
                alt="Hidden State"
              />
              <p
                *ngSwitchCase="'STORY_POINT_REVEAL'"
                class="text-main-text card_button font-semibold"
              >
                {{ user.userData.data?.storyPoints }}
              </p>
              <img
                *ngSwitchDefault
                src="../../assets/pending-state.svg"
                alt="Pending State"
              />
            </ng-container>
            <div class="font-inner-text text-main-text text-base">
              {{
                user.userData.displayName.length < 14
                  ? user.userData.displayName
                  : user.userData.displayName.slice(0, 8)
              }}<span
                class="text-main-text"
                *ngIf="user.userData.displayName.length > 14"
                >...</span
              >
            </div>
          </div>
        </div>

        <button
          *ngIf="!isStoryPointsRevealed && this.user.isAdmin"
          [disabled]="isRevealBtnDisabled"
          class="mt-12 xxs:mt-10 sm:mt-14 md:mt-10 bg-scrum-button-inner-background hover:bg-hover-color active:bg-active-color font-medium text-scrum-button-inner-text px-6 py-2 rounded-lg font-inner-text text-base"
          (click)="revealStoryPoints()"
        >
          Reveal
        </button>
        <button
          *ngIf="isStoryPointsRevealed && this.user.isAdmin"
          class="mt-12 xxs:mt-10 sm:mt-14 md:mt-10 bg-scrum-button-inner-background hover:bg-hover-color active:bg-active-color font-medium text-scrum-button-inner-text px-6 py-2 rounded-lg font-inner-text text-base"
          (click)="resetStoryPoints()"
        >
          Reset
        </button>
      </div>

      <div
        class="flex flex-row flex-wrap justify-center items-center md:h-28 gap-3 mx-3 my-2 text-justify xxs:w-[260px] sm: w-[334px] md:w-auto animate-popin-animation"
      >
        <ng-container *ngIf="!isStoryPointsRevealed; else storyPointsAverage">
          <button
            *ngFor="let points of series; let index = index"
            (click)="updateStoryPoints(points, index)"
            [class.active-button]="activeIndex === index"
            class="card card_button hover:bg-card-light active:bg-primary-shade-color w-[56px] h-[84px] rounded-md bg-white text-scrum-button-inner-text mt-3 font-semibold py-2 px-4 transition"
          >
            {{ points }}
          </button>
        </ng-container>
      </div>

      <ng-template #storyPointsAverage>
        <ng-container *ngFor="let data of storyPointsData">
          <div
            class="flex flex-row justify-center items-center gap-2 xxs:hidden xs:hidden"
          >
            <button
              class="card_selected card_button w-[56px] h-[84px] rounded-md bg-white text-scrum-button-inner-text font-semibold py-2 px-4 box shadow-md transition"
            >
              {{ data.points }}
            </button>
            <p
              class="flex justify-center card_button text-scrum-button-inner-text text-center font-card-points"
            >
              &#215;{{ data.repetition }}
            </p>
          </div>
        </ng-container>

        <div class="flex items-center gap-2">
          <img
            src="../../assets/approximate-symbol.svg"
            alt="Approximate Symbol"
          />
          <div
            class="card_button py-3 px-6 outline-none bg-scrum-button-inner-background leading-6 rounded-[28px] shadow text-scrum-button-inner-text font-semibold"
          >
            {{ averageStoryPointsValue  }}
          </div>
        </div>
      </ng-template>
    </div>

    <ng-template #restart>
      <button
        class="mt-12 xxs:mt-10 sm:mt-14 md:mt-0 font-inner-text text-main-text"
        mat-raised-button
      >
        Restart
      </button>
    </ng-template>

    <ng-template #pointsSelectedState>
      <img src="../../assets/selected-state.svg" alt="Selected State" />
    </ng-template>

    <ng-template #pointsHiddenState>
      <img
        src="../../assets/hidden-state.svg"
        alt="Hidden State"
        class="opacity-50"
      />
    </ng-template>
  </div>
</div>
